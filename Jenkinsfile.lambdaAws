pipeline {

    agent any
    stages {
        stage('Init') {
          steps {
            dir('setup'){
              echo 'Terraform init in progress'
              sh '''
                terraform init
              '''
            }
          }
        }

        stage('Plan') {
          dir('setup'){
            steps {
              echo 'Terraform Plan in progress'
              sh '''
                terraform plan
              '''
            }
          }
        }

      stage('Apply and deploy') {
        dir('setup'){
          steps {
            echo 'Terraform Plan in progress'
            sh '''
              terraform apply -auto-approve
            '''
          }
        }
      }
    }

}
